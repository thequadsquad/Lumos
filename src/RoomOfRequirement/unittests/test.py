import unittest
import numpy as np

from RoomOfRequirement.utils import *

class TestRasterizing(unittest.TestCase):
    def test_Polygon(self):
        geo = Polygon(((2,1), (1,2), (2,3), (5,2), (2,1)))
        a   = np.array([[  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0, 0.5, np.float32(5/6), 0.5, np.float32(1/6), 0, 0, 0, 0, 0, 0,   0],
                       [0 , 0.5,   np.float32(5/6) , 0.5 , np.float32(1/6) ,0, 0,  0, 0,  0, 0, 0 ],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0]]) 
       
        self.assertTrue((to_mask_pct(geo,  12, 10) == a ).all() )

    def test_MultiPolygon(self):
        geo2 = MultiPolygon([( ((0, 0), (0, 3), (3, 3), (3, 0)), [((1,1), (1,2), (2,2), (2,1))], ((3,3), (5,3), (3,5), (3,3)) ), [((3,3), (5,3), (3,5), (3,3))]])
        a2 = np.array([[1. , 1. , 1. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],
                       [1. , 0. , 1. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],
                       [1. , 1. , 1. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],
                       [0. , 0. , 0. , 1. , 0.5, 0. , 0. , 0. , 0. , 0. , 0. , 0. ],
                       [0. , 0. , 0. , 0.5, 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],
                       [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],
                       [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],
                       [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],
                       [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ],
                       [0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. , 0. ]])

        self.assertTrue((to_mask_pct(geo2, 12, 10) == a2).all() )
        self.assertFalse((to_mask_pct(geo2, 12, 10) > 1 ).all() ) 

    def test_emptyPolygon(self):
        geo3 = Polygon(())
        a3 = np.array([[  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0]]) 
        
        self.assertTrue((to_mask_pct(geo3, 12, 10) == a3).all() )

    def test_emptyMultiPolygon(self):
        geo4 = MultiPolygon(())
        a3 = np.array([[  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0],
                       [  0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0,   0]]) 
        
        self.assertTrue((to_mask_pct(geo4, 12, 10) == a3).all() )

    #def test_GeometryColl(self):

    def test_Point(self):
        geo5 = Point((1,1))
        with self.assertRaises(Exception):
            to_mask_pct(geo5, 12, 10)

    def test_MultiPoint(self):
        geo5 = MultiPoint(((1,1),(2,2)))
        with self.assertRaises(Exception):
            to_mask_pct(geo5, 12, 10)
     
if __name__ == '__main__':
    unittest.main()

